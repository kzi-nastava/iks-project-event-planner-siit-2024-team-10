<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<div class="main-container">
  <!-- Carousel Section -->
  <div class="carousel-section">
    <div class="carousel-container">
      <div class="main-image-wrapper">
        <img [src]="images[activeImage]" [alt]="offering?.name" class="main-image">
        
        <!-- Navigation Arrows -->
        <button class="carousel-nav prev" (click)="setActiveImage((activeImage - 1 + images.length) % images.length)" 
                *ngIf="images.length > 1">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="carousel-nav next" (click)="setActiveImage((activeImage + 1) % images.length)"
                *ngIf="images.length > 1">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
      
      <!-- Thumbnails -->
      <div class="thumbnails" *ngIf="images.length > 1">
        <div class="thumbnail-container">
          <div class="thumbnail-wrapper" *ngFor="let image of images; let i = index"
               [class.active]="i === activeImage"
               (click)="setActiveImage(i)">
            <img [src]="image" [alt]="offering?.name" class="thumbnail-image">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Section -->
  <div class="content-section">
    <!-- Header Info -->
    <div class="header-info">
      <h1 class="title">{{offering?.name}}</h1>
      <div class="meta-info">
        <span class="category">{{offering?.category.name}}</span>
        <div class="availability" [class.available]="offering?.available">
          {{offering?.available ? 'Available' : 'Not Available'}}
        </div>
      </div>
    </div>

  <!-- Price Section -->
  <div class="price-section">
    <div class="price-container">
      <div class="prices">
        <ng-container *ngIf="offering?.discount; else normalPrice">
          <div class="price-stack">
            <span class="original-price">{{offering?.price | currency}}</span>
            <span class="discounted-price">
              {{(offering?.price * (1 - offering?.discount / 100)) | currency}}
            </span>
          </div>
          <span class="discount-badge">
            -{{offering?.discount}}% OFF
          </span>
        </ng-container>
        <ng-template #normalPrice>
          <span class="price">{{offering?.price | currency}}</span>
        </ng-template>
      </div>
    </div>
    <div class="action-buttons">
      <button class="book-now-btn" [disabled]="!offering?.available" (click)="openReservationDialog()">
        <i class="fas fa-calendar-check"></i>
        Book Now
      </button>
      <button class="favorite-btn" [class.active]="isFavorite" (click)="toggleFavorite()">
        <span class="heart-icon">{{isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}}</span>
      </button>
    </div>
  </div>

    <!-- Description -->
    <div class="description-section">
      <h2>Description</h2>
      <p class="description">{{offering?.description}}</p>
    </div>

    <!-- Specifications for Services -->
    <div class="specifications-section" *ngIf="isService(offering)">
      <h2>Service Details</h2>
      <div class="specs-grid">
        <div class="spec-item">
          <span class="spec-label">Duration:</span>
          <span class="spec-value">{{offering?.fixedTime || offering?.minDuration + ' - ' + offering?.maxDuration}} hours</span>
        </div>
        <div class="spec-item">
          <span class="spec-label">Reservation Period:</span>
          <span class="spec-value">{{offering?.reservationPeriod}} hours in advance</span>
        </div>
        <div class="spec-item">
          <span class="spec-label">Cancellation Period:</span>
          <span class="spec-value">{{offering?.cancellationPeriod}} days before</span>
        </div>
        <div class="spec-item">
          <span class="spec-label">Specification:</span>
          <span class="spec-value">{{offering?.specification}} days before</span>
        </div>
        <div class="spec-item">
          <span class="spec-label">Confirmation:</span>
          <span class="spec-value">
            {{ offering?.autoConfirm ? 'Automatic' : 'Manual' }}
          </span>
        </div>        
      </div>
    </div>

    <!-- Provider Section -->
    <div class="provider-section">
      <div class="provider-card">
        <div class="provider-info">
          <img [src]="offering.provider.profilePhoto" alt="Provider" class="provider-avatar">
          <div class="provider-details">
            <h3>{{offering.provider.company.name}}</h3>
            <div class="rating">
              <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
              <span class="rating-number">({{offering.averageRating}})</span>
            </div>
            <p class="provider-location">
              <i class="fas fa-location">üìç</i>
              {{ offering.provider.company.location.city }}, {{ offering.provider.company.location.country }}
            </p>
            <div class="provider-contact">
              <p class="contact-item">
                <i class="fas fa-email">üìß</i>
                {{ offering.provider.company.email }}
              </p>
              <p class="contact-item">
                <i class="fas fa-phone"></i>
                {{ offering.provider.company.phoneNumber }}
              </p>
            </div>
          </div>
        </div>
        <div class="provider-actions">
          <button class="view-profile-btn" (click)="viewProviderProfile()">
            <i class="fas fa-user"></i>
            View Profile
          </button>
          <button class="report-btn" (click)="chat()">
            <i class="fas fa-comment"></i>
            You need more info? Chat with us
          </button>
        </div>
      </div>
    </div>

    <!-- Comments Section -->
    <div class="comments-section">
      <h2>Customer Reviews</h2>
      
      <!-- Add Comment Form -->
      <div class="comment-form">
        <ng-container *ngIf="!isCommentingEnabled">
          <div class="comment-locked-message">
            <i class="fas fa-lock"></i>
            <p>Please book this service first to leave a review</p>
          </div>
        </ng-container>
    
        <ng-container *ngIf="isCommentingEnabled">
          <h3>Leave a Review</h3>
          <div class="rating-input">
            <span>Your Rating:</span>
            <div class="stars-input">
              <span 
                *ngFor="let star of getStarArray(5); let i = index"
                (click)="setRating(i + 1)"
                [class.filled]="i < userRating"
                class="star-icon"
              >‚òÖ</span>
            </div>
          </div>
          <textarea 
            [(ngModel)]="newComment.text" 
            placeholder="Your Review"
            class="input-field"
          ></textarea>
          <button 
            (click)="submitComment()"
            class="submit-btn"
            [disabled]="!newComment.text || !newComment.rating"
          >Submit Review</button>
        </ng-container>
      </div>
  
      <!-- Existing Comments -->
      <div class="comments-list">
        <div *ngFor="let comment of comments" class="comment-card">
          <div class="comment-header">
            <span class="user-name">{{ comment.user }}</span>
            <div class="stars">
              <span *ngFor="let star of getStarArray(comment.rating)">
                {{ star ? '‚òÖ' : '‚òÜ' }}
              </span>
            </div>
          </div>
          <p class="comment-text">{{ comment.content }}</p>
          <!-- <span class="comment-date">{{ comment.date | date }}</span> -->
        </div>
      </div>
      
    <!-- Fab -->
    </div>  
    <div class="fab-container" *ngIf="offering">
      <button class="edit-fab" (click)="navigateToEdit()">
        <i class="fas fa-edit"></i> 
      </button>
      <button class="edit-fab" style="margin-bottom:70px;" (click)="deleteOffering()">
        <i class="fas fa-trash"></i> 
      </button>
    </div>
    